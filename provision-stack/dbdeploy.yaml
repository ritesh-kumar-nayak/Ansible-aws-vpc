---
- name: Deploy sql file on accounts db
  hosts: dbserver_group
  gather_facts: no
  tasks:
    - name: Copy SQL to dbserver
      copy:
        src: files/db_backup.sql
        dest: /tmp/db_backup.sql
      tags:
        - deploy

    - name: Restoring DB
      mysql_db:
        name: "{ {dbname} }"
        login_user: "{{dbuser}}"
        login_password: "{{dbpass}}"
        state: import                 # the copied sql file will be imported into the database and create the accounts db accordingly
        target: /tmp/db_backup.sql
      notify:
        - Restart mysql
      tags:
        - deploy
  handlers:
    - name: Restart Mysql
      service:
        name: mysql
        state: restarted